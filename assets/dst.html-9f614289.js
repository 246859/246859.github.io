import{_ as i,W as d,X as l,a0 as t,Y as e,Z as a,$ as c,a1 as s,C as r}from"./framework-b5ea9e64.js";const o={},p=e("h1",{id:"在linux搭建dst专用服务器",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#在linux搭建dst专用服务器","aria-hidden":"true"},"#"),a(" 在Linux搭建DST专用服务器")],-1),u=e("figure",null,[e("img",{src:"https://public-1308755698.cos.ap-chongqing.myqcloud.com//img/202304091448764.png",alt:"",tabindex:"0",loading:"lazy"}),e("figcaption")],-1),m=e("p",null,"本文主要讲解了如何在Linux环境下搭建Dont Starve Together的专用服务器，以及一些坑。",-1),v=s(`<hr><h2 id="环境准备" tabindex="-1"><a class="header-anchor" href="#环境准备" aria-hidden="true">#</a> 环境准备</h2><p>在开始之前需要准备以下东西：</p><ul><li>一台装了Linux系统的云服务器，本文使用的是Ubuntu20LTS。</li><li>SSH客户端，本文使用的XShell</li><li>SFTP客户端，本文使用的是FillZilla</li></ul><p>云服务器安全组要放行10800到12000范围端口，饥荒服务端差不多都在这个范围内，协议使用UDP。</p><h2 id="创建用户" tabindex="-1"><a class="header-anchor" href="#创建用户" aria-hidden="true">#</a> 创建用户</h2><p>与服务器进行ssh连接过后，创建一个专门用于DST管理的用户，这样与系统隔离，方便后续管理。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ adduser dst
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后进入dst的ssh目录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> ~/.ssh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>生成ssh密钥对，将公钥注册到服务器中</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ ssh-keygen
$ <span class="token function">cat</span> id_rsa.pub <span class="token operator">&gt;</span> authorized_keys
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>把私钥保存下来这样后续就可以使用ssh私钥进行登录。</p><h2 id="依赖准备" tabindex="-1"><a class="header-anchor" href="#依赖准备" aria-hidden="true">#</a> 依赖准备</h2><p>首先首先要给软件管理工具加一个i386的架构，有warning忽略掉，然后看看加进去没有</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ add-apt-repository multiverse
$ dpkg --add-architecture i386
$ dpkg --print-foreign-architectures
i386
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后再下载所需要的32位依赖</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">apt-get</span> update
$ <span class="token function">apt</span> <span class="token function">install</span> lib32gcc1 lib32z1 lib32stdc++6
$ <span class="token function">apt</span> instal libcurl3-gnutls:i386 <span class="token comment"># curl工具一定要安装32位的</span>
$ <span class="token function">apt</span> <span class="token function">install</span> libcurl4-gnutls-dev:i386 <span class="token comment"># 上面那个不行就安装这一个</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述依赖是必须安装的，否则在运行可执行文件时会报错无法找到文件。</p><h2 id="安装steamcmd" tabindex="-1"><a class="header-anchor" href="#安装steamcmd" aria-hidden="true">#</a> 安装SteamCMD</h2>`,20),h={class:"hint-container tip"},b=e("p",{class:"hint-container-title"},"提示",-1),g={href:"https://developer.valvesoftware.com/wiki/SteamCMD:zh-cn",target:"_blank",rel:"noopener noreferrer"},f=s(`<p>先切换到dst用户</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">su</span> - dst
$ <span class="token function">sudo</span> <span class="token function">mkdir</span> steam
$ <span class="token function">sudo</span> <span class="token function">mkdir</span> server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后下载SteamCMD压缩包</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">wget</span> https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>将其解压到steam目录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-xvzf</span> steamcmd_linux.tar.gz <span class="token parameter variable">-C</span> ~/steam
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后进入steam目录执行steamcmd.sh脚本启动进行安装</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> steam
$ ./steamcmd.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>或者也可以直接下载软件包，然后再启动steamcmd</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">apt-get</span> <span class="token function">install</span> steamcmd
$ steamcmd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>等待安装完成后在steamcmd里面执行如下命令来设置安装目录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ force_install_dir /home/dst/server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>需要注意的是设置安装目录必须在登录之前操作，登陆后不能再修改该项</p></div><p>然后再登录steam，一般使用匿名登录。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ login anonymous
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>等待登录完成后下载饥荒服务端，343050是它的appid，这里大概要等个几分钟，下载完毕后先退出。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ app_update <span class="token number">343050</span> validate
$ quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>进入到server目录下看看是不是安装到指定目录了，如下就说明安装成功了</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> ~/server/bin
$ <span class="token function">ls</span>
dontstarve  dontstarve_dedicated_server_nullrenderer  dontstarve.xpm  lib32  scripts  steam_appid.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="开服" tabindex="-1"><a class="header-anchor" href="#开服" aria-hidden="true">#</a> 开服</h2><p>前往克雷官网，登录并注册申请服务器token</p><figure><img src="https://public-1308755698.cos.ap-chongqing.myqcloud.com//img/202304092018313.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>点击添加新的服务器</p><figure><img src="https://public-1308755698.cos.ap-chongqing.myqcloud.com//img/202304092018095.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>完成后点击下载设置，使用sftp将该文件夹传入<code>/home/dst/.klei/DoNotStarveTogether</code>目录下，这是默认的存档位置，没有这个文件夹就自行创建该文件夹。</p><figure><img src="https://public-1308755698.cos.ap-chongqing.myqcloud.com//img/202304092020790.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>然后需要下载一个多终端管理工具screen</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">screen</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后在<code>/home/dst</code>目录下创建<code>master.sh</code>和<code>caves.sh</code>，内容如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">cd</span> /home/dst/server/bin/
<span class="token function">screen</span> <span class="token parameter variable">-R</span> master /home/dst/server/bin/dontstarve_dedicated_server_nullrenderer <span class="token parameter variable">-console</span> <span class="token parameter variable">-cluster</span> MyDediServer <span class="token parameter variable">-shard</span> Master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#!/bin/bash
cd /home/dst/server/bin/
screen -R caves /home/dst/server/bin/dontstarve_dedicated_server_nullrenderer -console -cluster MyDediServer -shard Caves
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后运行脚本即可，如下</p><figure><img src="https://public-1308755698.cos.ap-chongqing.myqcloud.com//img/202304092026834.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>当两个maser终端和caves终端都输出sim paused时，说明开服成功，进入游戏在搜索你设置的服务器名称</p><figure><img src="https://public-1308755698.cos.ap-chongqing.myqcloud.com//img/202304092028986.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>能够搜索到并成功进入服务器，说明服务器搭建完毕。</p>`,36);function k(x,_){const n=r("ExternalLinkIcon");return d(),l("div",null,[p,u,m,t(" more "),v,e("div",h,[b,e("p",null,[a("如何在Linux上安装SteamCMD官方有非常详细的中文教程，"),e("a",g,[a("Steam 控制台客户端 - Valve Developer Community (valvesoftware.com)"),c(n)])])]),f])}const y=i(o,[["render",k],["__file","dst.html.vue"]]);export{y as default};
