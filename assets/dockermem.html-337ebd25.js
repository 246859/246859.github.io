import{_ as c,W as r,X as s,Y as a,Z as e,$ as o,a0 as n,C as l}from"./framework-a4c02b8f.js";const i={},d=e("h1",{id:"docker内存显示异常的bug",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#docker内存显示异常的bug","aria-hidden":"true"},"#"),o(" docker内存显示异常的bug")],-1),_=e("p",null,"源于项目开发过程中的一个发现",-1),u=e("hr",null,null,-1),h=e("p",null,"此前接了一个开发饥荒虚拟容器管理平台的项目，其中有一个功能就是实时显示容器的内存使用状况，后来奇怪的发现容器的内存趋势图在容器创建后的5分钟内达到了几乎100%",-1),m=e("figure",null,[e("img",{src:"https://public-1308755698.cos.ap-chongqing.myqcloud.com//img/202306292022189.png",alt:"",tabindex:"0",loading:"lazy"}),e("figcaption")],-1),b=e("code",null,"top",-1),p={href:"https://github.com/moby/moby/blob/eb131c5383db8cac633919f82abad86c99bffbe5/cli/command/container/stats_helpers.go#LL110C62-L110C62",target:"_blank",rel:"noopener noreferrer"},g=e("p",null,"在经过测试后，这个bug诱发的原因是饥荒容器在创建时会下载一个接近4个g的游戏服务端，在此过程中会消耗一定的资源，内存占用会逐渐攀升，但是等到下载完毕后增长的趋势依旧不停，从而造成了内存虚高。",-1),f={href:"https://github.com/moby/moby/issues/45727",target:"_blank",rel:"noopener noreferrer"};function k(x,y){const t=l("ExternalLinkIcon");return r(),s("div",null,[d,_,a(" more "),u,h,m,e("p",null,[o("初次遇到这个问题，百思不得其解，以为是自己程序的编写错误，后来在容器中"),b,o("了一下发现真实占用可能就40%左右。后面去翻阅了docker cli计算内存占用的源代码，"),e("a",p,[o("Docker Cli 计算内存源代码地址"),n(t)]),o("，逻辑基本上是一致，那么只剩一种可能，这的确就是docker的bug。")]),g,e("p",null,[o("为此编写了一个测试，这在github的issue里有更详细的介绍，"),e("a",f,[o("issue address"),n(t)])])])}const L=c(i,[["render",k],["__file","dockermem.html.vue"]]);export{L as default};
