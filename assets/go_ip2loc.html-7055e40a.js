import{_ as e,W as o,X as p,Y as i,Z as n,$ as s,a0 as t,a1 as c,C as l}from"./framework-a4c02b8f.js";const u={},r=n("h1",{id:"使用ip2location包转换ip地址",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#使用ip2location包转换ip地址","aria-hidden":"true"},"#"),s(" 使用ip2location包转换IP地址")],-1),d=n("figure",null,[n("img",{src:"https://public-1308755698.cos.ap-chongqing.myqcloud.com//img/202403111750936.png",alt:"",tabindex:"0",loading:"lazy"}),n("figcaption")],-1),k=n("hr",null,null,-1),v={href:"https://lite.ip2location.com/%E3%80%82",target:"_blank",rel:"noopener noreferrer"},m=n("p",null,"免费数据库只能查询国家代码，更多功能只有付费数据库可以使用，它们的数据库也就是一个单独的文件或者CSV文件。",-1),b=n("h2",{id:"下载",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#下载","aria-hidden":"true"},"#"),s(" 下载")],-1),h={href:"https://lite.ip2location.com/database-download",target:"_blank",rel:"noopener noreferrer"},g={href:"https://ip2location-go.readthedocs.io/en/latest/index.html",target:"_blank",rel:"noopener noreferrer"},f=c(`<h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用" aria-hidden="true">#</a> 使用</h2><p>它们提供了专门GO API来操作数据库，所以对于go而言可以直接导入它们编写好的库就可以直接使用。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ go get github.com/ip2location/ip2location-go/v9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后直接通过go代码打开文件数据库，lite版本的数据文件很小只有2MB左右，完全可以嵌入到程序中，下面是一个使用案例</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;github.com/ip2location/ip2location-go/v9&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> ip2location<span class="token punctuation">.</span><span class="token function">OpenDB</span><span class="token punctuation">(</span><span class="token string">&quot;IP2LOCATION-LITE-DB1.BIN&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	info<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Get_all</span><span class="token punctuation">(</span><span class="token string">&quot;45.11.104.59&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span><span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>Country_short<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>Country_long<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>Timezone<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>HK
Hong Kong
This parameter is unavailable for selected data file. Please upgrade the data file.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从输出可以看到，只能查询国家代码，如果想要时区之类的一些信息需要付费购买更高级的数据库，不过对大多数人而言国家代码已经够用了。</p><h2 id="性能" tabindex="-1"><a class="header-anchor" href="#性能" aria-hidden="true">#</a> 性能</h2><p>下面是一个基准测试，来测试lite版本的查询性能如何</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">BenchmarkIp2Loc</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	t<span class="token punctuation">.</span><span class="token function">ReportAllocs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	t<span class="token punctuation">.</span><span class="token function">ResetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> ip2location<span class="token punctuation">.</span><span class="token function">OpenDB</span><span class="token punctuation">(</span><span class="token string">&quot;IP2LOCATION-LITE-DB1.BIN&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> t<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		db<span class="token punctuation">.</span><span class="token function">Get_all</span><span class="token punctuation">(</span><span class="token string">&quot;45.11.104.59&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>goos: windows
goarch: amd64
pkg: golearn
cpu: 11th Gen Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Core<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> i7-11800H @ <span class="token number">2</span>.30GHz
BenchmarkIp2Loc
BenchmarkIp2Loc-16         <span class="token number">59758</span>             <span class="token number">18791</span> ns/op             <span class="token number">616</span> B/op			<span class="token number">9</span> allocs/op
PASS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到的是单次查询性能在18微秒左右，还是比较可以的。</p>`,14);function _(x,I){const a=l("ExternalLinkIcon");return o(),p("div",null,[r,d,i(" more "),k,n("p",null,[s("ip2loction是一个组织，它们提供IP数据库，可以通过IP地址解析道各种各样的信息，比如地区代码，时区等等，网站："),n("a",v,[s("https://lite.ip2location.com/。"),t(a)])]),m,b,n("p",null,[s("下载地址："),n("a",h,[s("Database Download (ip2location.com)"),t(a)])]),n("p",null,[s("文档地址："),n("a",g,[s("IP2Location Go Package — IP2Location Go (ip2location-go.readthedocs.io)"),t(a)])]),f])}const q=e(u,[["render",_],["__file","go_ip2loc.html.vue"]]);export{q as default};
